name: Generate Diziyou M3U

on:
  workflow_dispatch:  # Manuel Ã§alÄ±ÅŸtÄ±rma
  schedule:
    # Her 36 saatte bir otomatik Ã§alÄ±ÅŸtÄ±r
    - cron: '0 */36 * * *'

jobs:
  generate-m3u:
    runs-on: ubuntu-latest
    timeout-minutes: 30  # Paralel iÅŸlemle 30 dakika YETERLÄ°
    
    steps:
    - name: ğŸ›ï¸ Repository'yi al
      uses: actions/checkout@v3
    
    - name: ğŸ Python kurulumu
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: ğŸ“¦ Gereksinimleri yÃ¼kle
      run: |
        python -m pip install --upgrade pip
        pip install requests==2.31.0 beautifulsoup4==4.12.0
    
    - name: ğŸš€ OPTÄ°MÄ°ZE M3U oluÅŸtur
      id: generate
      run: |
        echo "OPTÄ°MÄ°ZE PARALEL SCRIPT Ã‡ALIÅTIRILIYOR..."
        python diziyou_m3u.py
        
        echo ""
        if [ -f "diziyou.m3u" ]; then
          echo "âœ… diziyou.m3u oluÅŸturuldu"
          echo "ğŸ“Š Boyut: $(ls -lh diziyou.m3u | awk '{print $5}')"
          echo "ğŸ“„ SatÄ±r: $(wc -l < diziyou.m3u)"
          echo "file_created=true" >> $GITHUB_OUTPUT
        else
          echo "âŒ HATA: M3U dosyasÄ± oluÅŸturulamadÄ±!"
          echo "file_created=false" >> $GITHUB_OUTPUT
          exit 1
        fi
    
    - name: ğŸ’¾ Depoya kaydet
      if: steps.generate.outputs.file_created == 'true'
      run: |
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"
        
        if git diff --name-only | grep -q "diziyou.m3u"; then
          git add diziyou.m3u
          git commit -m "ğŸ¤– M3U paralel gÃ¼ncelleme [$(date +'%Y-%m-%d %H:%M')]"
          git push
          echo "âœ… Depoya kaydedildi"
        else
          echo "â„¹ï¸  DeÄŸiÅŸiklik yok"
        fi
