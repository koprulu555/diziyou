name: Generate Diziyou M3U

on:
  schedule:
    # Her 36 saatte bir (UTC zamanÄ±)
    - cron: '0 */36 * * *'
  workflow_dispatch:  # Manuel Ã§alÄ±ÅŸtÄ±rma iÃ§in
  push:
    branches: [ main ]

jobs:
  generate-m3u:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ›ï¸ Repository'yi al
      uses: actions/checkout@v3
      with:
        fetch-depth: 0  # TÃ¼m geÃ§miÅŸi al
    
    - name: ğŸ Python kur
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: ğŸ“¦ Gereksinimleri yÃ¼kle
      run: |
        python -m pip install --upgrade pip
        pip install requests beautifulsoup4
    
    - name: ğŸš€ M3U oluÅŸtur
      run: |
        echo "M3U oluÅŸturucu Ã§alÄ±ÅŸtÄ±rÄ±lÄ±yor..."
        python diziyou_m3u.py
        
        echo "OluÅŸturulan dosya kontrolÃ¼:"
        ls -la *.m3u 2>/dev/null || echo "M3U dosyasÄ± bulunamadÄ±!"
        
        if [ -f "diziyou.m3u" ]; then
          echo "âœ… M3U dosyasÄ± baÅŸarÄ±yla oluÅŸturuldu"
          echo "ğŸ“Š Dosya bilgisi:"
          wc -l diziyou.m3u
          head -5 diziyou.m3u
        else
          echo "âŒ M3U dosyasÄ± oluÅŸturulamadÄ±!"
          exit 1
        fi
    
    - name: ğŸ’¾ DeÄŸiÅŸiklikleri depoya kaydet
      run: |
        # Git yapÄ±landÄ±rmasÄ±
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"
        
        # M3U dosyasÄ±nÄ± kontrol et
        if [ ! -f "diziyou.m3u" ]; then
          echo "HATA: diziyou.m3u dosyasÄ± bulunamadÄ±!"
          exit 1
        fi
        
        # DeÄŸiÅŸiklik var mÄ± kontrol et
        if git diff --quiet diziyou.m3u; then
          echo "â„¹ M3U dosyasÄ±nda deÄŸiÅŸiklik yok"
        else
          echo "âœ… M3U dosyasÄ± gÃ¼ncellendi, depoya kaydediliyor..."
          
          # DosyayÄ± ekle ve commit et
          git add diziyou.m3u
          git commit -m "ğŸ¤– M3U otomatik gÃ¼ncellendi [$(date +'%Y-%m-%d %H:%M')]"
          
          # DeÄŸiÅŸikliÄŸi gÃ¶nder
          git push
          echo "ğŸ‰ DeÄŸiÅŸiklikler depoya gÃ¶nderildi"
        fi
